# 开发环境专用配置
# 使用方式: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: ${PROJECT_NAME:-app}:dev
    ports:
      - "${API_PORT:-8001}:${API_PORT:-8001}"
    environment:
      - ENV=development
    volumes:
      - ./app:/app/app
      - ./logs:/app/logs

  # Celery Worker - 复用开发环境镜像
  celery-worker:
    image: ${PROJECT_NAME:-app}:dev
    environment:
      - ENV=development
    volumes:
      - ./app:/app/app  # 挂载代码目录以支持热更新
      - ./logs:/app/logs
    networks:
      - app-network

  # Celery Beat - 复用开发环境镜像
  celery-beat:
    image: ${PROJECT_NAME:-app}:dev
    depends_on:
      - app  # 确保先构建 app

  # Flower - 复用开发环境镜像
  flower:
    image: ${PROJECT_NAME:-app}:dev
    depends_on:
      - app  # 确保先构建 app
      
  # 在开发环境中禁用Nginx服务
  nginx:
    profiles:
      - donotstart